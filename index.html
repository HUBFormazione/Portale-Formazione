<!doctype html>
<html lang="it">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Piattaforma E-Learning con Google Sheets</title>
  <script src="https://cdn.tailwindcss.com/3.3.0"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full"><!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
   <div class="text-center">
    <div class="spinner mx-auto mb-4"></div>
    <p class="text-white text-lg">Caricamento dati...</p>
   </div>
  </div><!-- ‚ö†Ô∏è CONFIGURAZIONE GOOGLE SHEETS - INSERISCI IL TUO URL QUI! -->
  <script>
        // üîß CONFIGURAZIONE - MODIFICA QUESTO URL CON IL TUO!
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/TUO_ID_SHEETS_QUI/exec';
        
        // ‚ö†Ô∏è ISTRUZIONI:
        // 1. Vai su Google Sheets e crea il foglio con Apps Script
        // 2. Pubblica come Web App e copia l'URL
        // 3. Sostituisci 'TUO_ID_SHEETS_QUI' con il tuo URL completo
        // 4. Esempio: 'https://script.google.com/macros/s/AKfycbxXXXXXXXXX/exec'
        
        // Verifica configurazione
        if (GOOGLE_SHEETS_URL.includes('TUO_ID_SHEETS_QUI')) {
            console.warn('‚ö†Ô∏è ATTENZIONE: Configura il GOOGLE_SHEETS_URL con il tuo URL di Google Sheets!');
        }
    </script><!-- Navigation -->
  <nav class="bg-white shadow-lg border-b-4 border-blue-500">
   <div class="max-w-7xl mx-auto px-4">
    <div class="flex justify-between items-center py-4">
     <div class="flex items-center space-x-3">
      <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center"><span class="text-white font-bold text-lg">üìö</span>
      </div>
      <h1 class="text-2xl font-bold text-gray-800">EduPlatform <span class="text-sm text-green-600">‚òÅÔ∏è Cloud</span></h1>
     </div>
     <div class="flex items-center space-x-4"><span id="currentUser" class="text-gray-600 font-medium"></span> <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors"> Logout </button>
     </div>
    </div>
   </div>
  </nav><!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
    <div class="text-center mb-8">
     <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4"><span class="text-white text-2xl">üéì</span>
     </div>
     <h2 class="text-3xl font-bold text-gray-800">Accedi alla Piattaforma</h2>
     <p class="text-gray-600 mt-2">Dati salvati su Google Sheets ‚òÅÔ∏è</p>
    </div>
    <form onsubmit="login(event)" class="space-y-6">
     <div><label class="block text-sm font-medium text-gray-700 mb-2">Email</label> <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div>
     <div><label class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
     </div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition-colors"> Accedi </button>
    </form>
    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
     <p class="text-sm text-gray-600 mb-2"><strong>Credenziali Demo:</strong></p>
     <p class="text-xs text-gray-500">Admin: admin@edu.com / admin123</p>
     <p class="text-xs text-gray-500">Studente: studente@edu.com / student123</p>
    </div>
    <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
     <p class="text-xs text-green-800">‚úÖ <strong>Dati Persistenti:</strong> I dati vengono salvati su Google Sheets e rimangono anche dopo il refresh!</p>
    </div>
   </div>
  </div><!-- Main Dashboard -->
  <div id="dashboard" class="hidden"><!-- Admin Dashboard -->
   <div id="adminDashboard" class="hidden max-w-7xl mx-auto p-6">
    <div class="mb-8">
     <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard Amministratore</h2>
     <p class="text-gray-600">Gestisci studenti e corsi - Dati salvati su Google Sheets ‚òÅÔ∏è</p>
    </div><!-- Admin Navigation Tabs -->
    <div class="flex space-x-1 mb-6 bg-gray-100 p-1 rounded-lg"><button onclick="showAdminTab('students')" id="studentsTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors bg-white text-blue-600 shadow-sm"> üë• Gestione Studenti </button> <button onclick="showAdminTab('courses')" id="coursesTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800"> üìö Gestione Corsi </button> <button onclick="showAdminTab('reports')" id="reportsTab" class="flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800"> üìä Report </button>
    </div><!-- Students Management -->
    <div id="studentsSection" class="fade-in">
     <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-xl font-semibold text-gray-800">Gestione Studenti</h3><button onclick="showModal('addStudentModal')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors"> ‚ûï Aggiungi Studente </button>
      </div>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="bg-gray-50">
         <tr>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nome</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Email</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Azienda</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Stato</th>
          <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Azioni</th>
         </tr>
        </thead>
        <tbody id="studentsTable" class="divide-y divide-gray-200"><!-- Students will be populated here -->
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Courses Management -->
    <div id="coursesSection" class="hidden">
     <div class="bg-white rounded-xl shadow-lg p-6">
      <div class="flex justify-between items-center mb-6">
       <h3 class="text-xl font-semibold text-gray-800">Gestione Corsi</h3><button onclick="showModal('addCourseModal')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors"> ‚ûï Crea Corso </button>
      </div>
      <div id="coursesList" class="space-y-4"><!-- Courses will be populated here -->
      </div>
     </div>
    </div><!-- Reports Section -->
    <div id="reportsSection" class="hidden">
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
      <div class="bg-white rounded-xl shadow-lg p-6">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-sm font-medium text-gray-600">Studenti Totali</p>
         <p id="totalStudents" class="text-3xl font-bold text-blue-600">0</p>
        </div>
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><span class="text-blue-600 text-xl">üë•</span>
        </div>
       </div>
      </div>
      <div class="bg-white rounded-xl shadow-lg p-6">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-sm font-medium text-gray-600">Corsi Attivi</p>
         <p id="totalCourses" class="text-3xl font-bold text-green-600">0</p>
        </div>
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center"><span class="text-green-600 text-xl">üìö</span>
        </div>
       </div>
      </div>
      <div class="bg-white rounded-xl shadow-lg p-6">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-sm font-medium text-gray-600">Completamenti</p>
         <p id="totalCompletions" class="text-3xl font-bold text-purple-600">0</p>
        </div>
        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"><span class="text-purple-600 text-xl">üèÜ</span>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Student Dashboard -->
   <div id="studentDashboard" class="hidden max-w-7xl mx-auto p-6">
    <div class="mb-8">
     <h2 class="text-3xl font-bold text-gray-800 mb-2">I Miei Corsi</h2>
     <p class="text-gray-600">Accedi ai tuoi corsi - Progressi salvati automaticamente ‚òÅÔ∏è</p>
    </div>
    <div id="studentCoursesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Student courses will be populated here -->
    </div>
   </div>
  </div><!-- Add Student Modal -->
  <div id="addStudentModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-full overflow-y-auto">
    <div class="p-6">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-semibold text-gray-800">Aggiungi Studente</h3><button onclick="hideModal('addStudentModal')" class="text-gray-400 hover:text-gray-600"> <span class="text-2xl">√ó</span> </button>
     </div>
     <form onsubmit="addStudent(event)" class="space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Nome</label> <input type="text" id="studentName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Cognome</label> <input type="text" id="studentSurname" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Email</label> <input type="email" id="studentEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Telefono</label> <input type="tel" id="studentPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Azienda</label> <input type="text" id="studentCompany" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div class="flex space-x-3 pt-4"><button type="button" onclick="hideModal('addStudentModal')" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"> Annulla </button> <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"> Aggiungi </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Add Course Modal -->
  <div id="addCourseModal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-full overflow-y-auto">
    <div class="p-6">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-semibold text-gray-800">Crea Nuovo Corso</h3><button onclick="hideModal('addCourseModal')" class="text-gray-400 hover:text-gray-600"> <span class="text-2xl">√ó</span> </button>
     </div>
     <form onsubmit="addCourse(event)" class="space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Titolo del Corso</label> <input type="text" id="courseTitle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">Descrizione</label> <textarea id="courseDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
      </div>
      <div class="flex items-center space-x-2"><input type="checkbox" id="courseHasTest" class="rounded"> <label for="courseHasTest" class="text-sm font-medium text-gray-700">Il corso include un test finale</label>
      </div>
      <div class="flex space-x-3 pt-4"><button type="button" onclick="hideModal('addCourseModal')" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50"> Annulla </button> <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"> Crea Corso </button>
      </div>
     </form>
    </div>
   </div>
  </div>
  <script>
        // ==========================================
        // GOOGLE SHEETS API FUNCTIONS
        // ==========================================

        // Mostra/nascondi loading
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Leggi dati da Google Sheets
        async function readFromSheets(sheetName) {
            try {
                showLoading();
                const response = await fetch(`${GOOGLE_SHEETS_URL}?action=read&sheet=${sheetName}`);
                const result = await response.json();
                hideLoading();
                
                if (result.status === 'success') {
                    return result.data;
                } else {
                    console.error('Errore lettura:', result.message);
                    alert('Errore nel caricamento dei dati: ' + result.message);
                    return [];
                }
            } catch (error) {
                hideLoading();
                console.error('Errore connessione Google Sheets:', error);
                alert('Errore di connessione a Google Sheets. Verifica la configurazione dell\'URL.');
                return [];
            }
        }

        // Scrivi dati su Google Sheets
        async function writeToSheets(sheetName, action, data) {
            try {
                showLoading();
                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        sheet: sheetName,
                        data: data
                    })
                });
                
                const result = await response.json();
                hideLoading();
                
                if (result.status === 'success') {
                    return result;
                } else {
                    console.error('Errore scrittura:', result.message);
                    alert('Errore nel salvataggio: ' + result.message);
                    return null;
                }
            } catch (error) {
                hideLoading();
                console.error('Errore connessione Google Sheets:', error);
                alert('Errore di connessione a Google Sheets.');
                return null;
            }
        }

        // ==========================================
        // GLOBAL STATE
        // ==========================================
        let currentUser = null;
        let students = [];
        let courses = [];
        let progressData = [];

        // ==========================================
        // AUTHENTICATION
        // ==========================================
        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Demo credentials (in produzione usa autenticazione vera!)
            const users = {
                'admin@edu.com': { role: 'admin', name: 'Amministratore', password: 'admin123' },
                'studente@edu.com': { role: 'student', name: 'Mario Rossi', password: 'student123' }
            };
            
            if (users[email] && users[email].password === password) {
                currentUser = { email, ...users[email] };
                document.getElementById('currentUser').textContent = currentUser.name;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                
                if (currentUser.role === 'admin') {
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    await loadAllData();
                } else if (currentUser.role === 'student') {
                    document.getElementById('studentDashboard').classList.remove('hidden');
                    await loadStudentCourses();
                }
            } else {
                alert('Credenziali non valide');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('studentDashboard').classList.add('hidden');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // ==========================================
        // DATA LOADING
        // ==========================================
        async function loadAllData() {
            students = await readFromSheets('Studenti');
            courses = await readFromSheets('Corsi');
            progressData = await readFromSheets('Progressi');
            
            loadStudents();
            loadCourses();
            updateStats();
        }

        // ==========================================
        // ADMIN FUNCTIONS
        // ==========================================
        function showAdminTab(tab) {
            document.getElementById('studentsSection').classList.add('hidden');
            document.getElementById('coursesSection').classList.add('hidden');
            document.getElementById('reportsSection').classList.add('hidden');
            
            document.getElementById('studentsTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800';
            document.getElementById('coursesTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800';
            document.getElementById('reportsTab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-colors text-gray-600 hover:text-gray-800';
            
            document.getElementById(tab + 'Section').classList.remove('hidden');
            document.getElementById(tab + 'Tab').className = 'flex-1 py-2 px-4 rounded-md font-medium transition-colors bg-white text-blue-600 shadow-sm';
            
            if (tab === 'reports') {
                updateStats();
            }
        }

        function loadStudents() {
            const tbody = document.getElementById('studentsTable');
            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">Nessuno studente presente. Aggiungi il primo studente!</td></tr>';
                return;
            }
            
            tbody.innerHTML = students.map(student => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900">${student.name} ${student.surname}</td>
                    <td class="px-4 py-3 text-sm text-gray-600">${student.email}</td>
                    <td class="px-4 py-3 text-sm text-gray-600">${student.company}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${student.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${student.status === 'active' ? 'Attivo' : 'Inattivo'}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <button onclick="deleteStudent('${student.id}')" class="text-red-600 hover:text-red-800 text-sm">Elimina</button>
                    </td>
                </tr>
            `).join('');
        }

        async function addStudent(event) {
            event.preventDefault();
            const name = document.getElementById('studentName').value;
            const surname = document.getElementById('studentSurname').value;
            const email = document.getElementById('studentEmail').value;
            const phone = document.getElementById('studentPhone').value;
            const company = document.getElementById('studentCompany').value;
            
            const newStudent = {
                id: Date.now().toString(),
                name,
                surname,
                email,
                phone,
                company,
                status: 'active',
                registrationDate: new Date().toISOString()
            };
            
            const result = await writeToSheets('Studenti', 'create', newStudent);
            
            if (result) {
                students.push(newStudent);
                loadStudents();
                hideModal('addStudentModal');
                alert(`Studente "${name} ${surname}" aggiunto con successo!`);
                
                // Reset form
                document.getElementById('studentName').value = '';
                document.getElementById('studentSurname').value = '';
                document.getElementById('studentEmail').value = '';
                document.getElementById('studentPhone').value = '';
                document.getElementById('studentCompany').value = '';
            }
        }

        async function deleteStudent(id) {
            if (confirm('Sei sicuro di voler eliminare questo studente?')) {
                const result = await writeToSheets('Studenti', 'delete', { id });
                
                if (result) {
                    students = students.filter(s => s.id !== id);
                    loadStudents();
                    alert('Studente eliminato con successo!');
                }
            }
        }

        function loadCourses() {
            const container = document.getElementById('coursesList');
            if (courses.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Nessun corso presente. Crea il primo corso!</p>';
                return;
            }
            
            container.innerHTML = courses.map(course => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-semibold text-gray-800">${course.title}</h4>
                            <p class="text-sm text-gray-600 mt-1">${course.description}</p>
                            <div class="flex items-center space-x-4 mt-2">
                                <span class="text-xs px-2 py-1 rounded-full ${course.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                    ${course.status === 'published' ? '‚úÖ Pubblicato' : 'üìù Bozza'}
                                </span>
                                ${course.hasTest === 'true' || course.hasTest === true ? '<span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">Con Test</span>' : ''}
                            </div>
                        </div>
                        <button onclick="deleteCourse('${course.id}')" class="text-red-600 hover:text-red-800 text-sm">Elimina</button>
                    </div>
                </div>
            `).join('');
        }

        async function addCourse(event) {
            event.preventDefault();
            const title = document.getElementById('courseTitle').value;
            const description = document.getElementById('courseDescription').value;
            const hasTest = document.getElementById('courseHasTest').checked;
            
            const newCourse = {
                id: Date.now().toString(),
                title,
                description,
                hasTest: hasTest.toString(),
                status: 'published',
                modules: '[]',
                createdDate: new Date().toISOString(),
                createdBy: currentUser.name
            };
            
            const result = await writeToSheets('Corsi', 'create', newCourse);
            
            if (result) {
                courses.push(newCourse);
                loadCourses();
                hideModal('addCourseModal');
                alert(`Corso "${title}" creato con successo!`);
                
                // Reset form
                document.getElementById('courseTitle').value = '';
                document.getElementById('courseDescription').value = '';
                document.getElementById('courseHasTest').checked = false;
            }
        }

        async function deleteCourse(id) {
            if (confirm('Sei sicuro di voler eliminare questo corso?')) {
                const result = await writeToSheets('Corsi', 'delete', { id });
                
                if (result) {
                    courses = courses.filter(c => c.id !== id);
                    loadCourses();
                    alert('Corso eliminato con successo!');
                }
            }
        }

        function updateStats() {
            document.getElementById('totalStudents').textContent = students.length;
            document.getElementById('totalCourses').textContent = courses.filter(c => c.status === 'published').length;
            
            const completions = progressData.filter(p => p.completed === 'true' || p.completed === true).length;
            document.getElementById('totalCompletions').textContent = completions;
        }

        // ==========================================
        // STUDENT FUNCTIONS
        // ==========================================
        async function loadStudentCourses() {
            const container = document.getElementById('studentCoursesList');
            
            if (courses.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-gray-400 text-2xl">üìö</span>
                        </div>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">Nessun corso disponibile</h3>
                        <p class="text-gray-500">Al momento non ci sono corsi pubblicati.</p>
                    </div>
                `;
                return;
            }
            
            const publishedCourses = courses.filter(c => c.status === 'published');
            
            container.innerHTML = publishedCourses.map(course => `
                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${course.title}</h3>
                    <p class="text-sm text-gray-600 mb-4">${course.description}</p>
                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                        Inizia Corso
                    </button>
                </div>
            `).join('');
        }

        // ==========================================
        // MODAL FUNCTIONS
        // ==========================================
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        document.addEventListener('DOMContentLoaded', function() {
            showAdminTab('students');
            
            // Verifica configurazione
            if (GOOGLE_SHEETS_URL.includes('TUO_ID_SHEETS_QUI')) {
                alert('‚ö†Ô∏è ATTENZIONE: Configura il GOOGLE_SHEETS_URL nel codice con il tuo URL di Google Sheets!\n\nCerca "GOOGLE_SHEETS_URL" nel codice e sostituisci con il tuo URL.');
            }
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a4b8d0f10694bf6',t:'MTc2NDE4MjgxMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
